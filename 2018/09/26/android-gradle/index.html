<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Android Gradle 作弊手册如何打一个可执行的jar包12345678910111213141516171819apply plugin: &apos;java&apos;dependencies &amp;#123;    compile fileTree(include: [&apos;*.jar&apos;], dir: &apos;libs&apos;)    compile files(&apos;libs/libhello.jar&apos;)    compi">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Gradle 作弊手册">
<meta property="og:url" content="http://yoursite.com/2018/09/26/android-gradle/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Android Gradle 作弊手册如何打一个可执行的jar包12345678910111213141516171819apply plugin: &apos;java&apos;dependencies &amp;#123;    compile fileTree(include: [&apos;*.jar&apos;], dir: &apos;libs&apos;)    compile files(&apos;libs/libhello.jar&apos;)    compi">
<meta property="og:locale" content="zh-cn">
<meta property="og:updated_time" content="2018-09-26T10:06:07.719Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Gradle 作弊手册">
<meta name="twitter:description" content="Android Gradle 作弊手册如何打一个可执行的jar包12345678910111213141516171819apply plugin: &apos;java&apos;dependencies &amp;#123;    compile fileTree(include: [&apos;*.jar&apos;], dir: &apos;libs&apos;)    compile files(&apos;libs/libhello.jar&apos;)    compi">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Android Gradle 作弊手册</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Inici</a></li>
         
          <li><a href="/about/">Qui som</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/projects_url">Projectes</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2018/09/24/node-design-patterns/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Post Anterior</span>
      <span id="i-next" class="info" style="display:none;">Post Següent</span>
      <span id="i-top" class="info" style="display:none;">Adalt</span>
      <span id="i-share" class="info" style="display:none;">Compartir Post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2018/09/26/android-gradle/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2018/09/26/android-gradle/&text=Android Gradle 作弊手册"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2018/09/26/android-gradle/&title=Android Gradle 作弊手册"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2018/09/26/android-gradle/&is_video=false&description=Android Gradle 作弊手册"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Android Gradle 作弊手册&body=Check out this article: http://yoursite.com/2018/09/26/android-gradle/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2018/09/26/android-gradle/&title=Android Gradle 作弊手册"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2018/09/26/android-gradle/&title=Android Gradle 作弊手册"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2018/09/26/android-gradle/&title=Android Gradle 作弊手册"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2018/09/26/android-gradle/&title=Android Gradle 作弊手册"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2018/09/26/android-gradle/&name=Android Gradle 作弊手册&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">Android Gradle 作弊手册</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.1.</span> <span class="toc-text">如何打一个可执行的jar包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.2.</span> <span class="toc-text">如何引入外部依赖?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.3.</span> <span class="toc-text">如何配置签名?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.4.</span> <span class="toc-text">如何通过gradlew打包?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.5.</span> <span class="toc-text">Build Variant</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.5.1.</span> <span class="toc-text">一个例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.5.2.</span> <span class="toc-text">Android的gradle插件在哪里?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.5.3.</span> <span class="toc-text">我们来看看flavor在android gradle plugin中是怎么定义的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.6.</span> <span class="toc-text">APK的优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.6.1.</span> <span class="toc-text">代码层面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.6.2.</span> <span class="toc-text">资源层面</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Android Gradle 作弊手册
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Hexo</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-09-26T10:06:07.719Z" itemprop="datePublished">2018-09-26</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1><span id="android-gradle-zuo-bi-shou-ce">Android Gradle 作弊手册</span></h1><h2><span id="ru-he-da-yi-ge-ke-zhi-xing-de-jar-bao">如何打一个可执行的jar包</span></h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'java'</span></span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile fileTree(<span class="string">include:</span> [<span class="string">'*.jar'</span>], <span class="string">dir:</span> <span class="string">'libs'</span>)</span><br><span class="line">    compile files(<span class="string">'libs/libhello.jar'</span>)</span><br><span class="line">    compile files(<span class="string">'libs/jcommander-1.72.jar'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> mainClassName = <span class="string">"com.example.Utils"</span></span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    manifest &#123;</span><br><span class="line">        attributes <span class="string">"Main-Class"</span>: <span class="string">"$mainClassName"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    from &#123;</span><br><span class="line">        configurations.compile.collect &#123; print <span class="string">"--&gt; "</span>+it; it.isDirectory() ? it : zipTree(it) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="ru-he-yin-ru-wai-bu-yi-lai">如何引入外部依赖?</span></h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># libs目录下面的jar文件也加入编译</span><br><span class="line">compile	fileTree(<span class="string">dir:</span>	‘libs’,	<span class="string">include:</span>	[‘*.jar’])</span><br><span class="line"></span><br><span class="line"># 引用子模块</span><br><span class="line">compile project(<span class="string">':libjava'</span>)</span><br><span class="line"></span><br><span class="line">compile files(<span class="string">'libs/foo.jar'</span>, <span class="string">'libs/bar.jar'</span>)\</span><br><span class="line"></span><br><span class="line"># 这俩是一个意思</span><br><span class="line">compile <span class="string">'com.example.android:app-magic:12.3'</span></span><br><span class="line">compile <span class="string">group:</span> <span class="string">'com.example.android'</span>, <span class="string">name:</span> <span class="string">'app-magic'</span>, <span class="string">version:</span> <span class="string">'12.3'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 不同的varint引入不同的模块</span><br><span class="line">dependencies &#123;</span><br><span class="line">  <span class="comment">// Adds the 'debug' varaint of the library to the debug varaint of the app</span></span><br><span class="line">  debugCompile project(<span class="string">path:</span> <span class="string">':my-library-module'</span>, <span class="string">configuration:</span> <span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Adds the 'release' varaint of the library to the release varaint of the app</span></span><br><span class="line">  releaseCompile project(<span class="string">path:</span> <span class="string">':my-library-module'</span>, <span class="string">configuration:</span> <span class="string">'release'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如何查看依赖?<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./gradlew -q dependencies your-app-project:dependencies</span><br></pre></td></tr></table></figure></p>
<h2><span id="ru-he-pei-zhi-qian-ming">如何配置签名?</span></h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    </span><br><span class="line">    signingConfigs	&#123;</span><br><span class="line">    	release	&#123;</span><br><span class="line">            storeFile file(“keystore.release”)</span><br><span class="line">            storePassword System.getenv(“KEYSTOREPASSWD”)</span><br><span class="line">            <span class="comment">//或通过终端输入 System.console().readLine (“\nEnter Passwords:“)						</span></span><br><span class="line">            keyAlias “your key alias here”</span><br><span class="line">            keyPassword System.getenv(“KEYPASSWD”)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="ru-he-tong-guo-gradlew-da-bao">如何通过gradlew打包?</span></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./gradlew &lt;task&gt;</span><br><span class="line">$ ./gradlew assembleDebug</span><br><span class="line">$ ./gradlew assembleRelease</span><br><span class="line"></span><br><span class="line"><span class="comment">## 如何用命令行打包flavors版本</span></span><br></pre></td></tr></table></figure>
<h2><span id="build-variant">Build Variant</span></h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">   productFlavors &#123;</span><br><span class="line">        cn &#123;</span><br><span class="line">            applicationId <span class="string">"a.m.a.s.ego_cn"</span></span><br><span class="line">            versionName <span class="string">"cn_1.0"</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        en &#123;</span><br><span class="line">            applicationId <span class="string">"a.m.a.s.ego_en"</span></span><br><span class="line">            versionName <span class="string">"en_1.0"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>cn/en就是flavors的id, 这个玩意回头要建立对应的目录保存各自的资源/代码</li>
<li>修改了当前的buildflavor后, 可以编译一下</li>
</ul>
<h3><span id="yi-ge-li-zi">一个例子</span></h3><ul>
<li>Init.java可以有各自的定义</li>
<li>activity_main.xml也可以有各自的定义<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">└── src</span><br><span class="line">    ├── cn</span><br><span class="line">    │   ├── java</span><br><span class="line">    │   │   └── a</span><br><span class="line">    │   │       └── m</span><br><span class="line">    │   │           └── a</span><br><span class="line">    │   │               └── s</span><br><span class="line">    │   │                   └── ego</span><br><span class="line">    │   │                       └── custom</span><br><span class="line">    │   │                           └── Init.java</span><br><span class="line">    │   └── res</span><br><span class="line">    │       └── layout</span><br><span class="line">    │           └── activity_main.xml</span><br><span class="line">    ├── en</span><br><span class="line">    │   ├── java</span><br><span class="line">    │   │   └── a</span><br><span class="line">    │   │       └── m</span><br><span class="line">    │   │           └── a</span><br><span class="line">    │   │               └── s</span><br><span class="line">    │   │                   └── ego</span><br><span class="line">    │   │                       └── custom</span><br><span class="line">    │   │                           └── Init.java</span><br><span class="line">    │   └── res</span><br><span class="line">    │       └── layout</span><br><span class="line">    │           └── activity_main.xml</span><br><span class="line">    ├── main</span><br><span class="line">    │   ├── AndroidManifest.xml</span><br><span class="line">    │   ├── java</span><br><span class="line">    │   │   └── a</span><br><span class="line">    │   │       └── m</span><br><span class="line">    │   │           └── a</span><br><span class="line">    │   │               └── s</span><br><span class="line">    │   │                   └── ego</span><br><span class="line">    │   │                       ├── custom</span><br><span class="line">    │   │                       │   └── IInit.java</span><br><span class="line">    │   │                       └── MainActivity.java</span><br><span class="line">    │   └── res</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3><span id="android-de-gradle-cha-jian-zai-na-li">Android的gradle插件在哪里?</span></h3><p>已经包含在android-studio中, 你可以到这里找到:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> android-studio</span><br><span class="line">$ <span class="built_in">cd</span> /gradle/m2repository/com/android/tools/build/builder/2.3.1/</span><br><span class="line">$ ls *</span><br><span class="line">gradle-api-2.3.1.jar</span><br></pre></td></tr></table></figure></p>
<p>在编辑gradle文件的时候可以F3查看在插件中是如何实现的</p>
<h3><span id="wo-men-lai-kan-kan-flavor-zai-android-gradle-plugin-zhong-shi-zen-me-ding-yi-de">我们来看看flavor在android gradle plugin中是怎么定义的</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.android.build.gradle.internal.dsl;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">public class ProductFlavor extends DefaultProductFlavor implements CoreProductFlavor &#123;</span><br><span class="line">    protected final Project project;</span><br><span class="line">    protected final Logger logger;</span><br><span class="line">    private final NdkOptions ndkConfig;</span><br><span class="line">    private final ExternalNativeBuildOptions externalNativeBuildOptions;</span><br><span class="line">    private final ErrorReporter errorReporter;</span><br><span class="line">    private final JackOptions jackOptions;</span><br><span class="line">    private final JavaCompileOptions javaCompileOptions;</span><br><span class="line">    private final ShaderOptions shaderOptions;</span><br><span class="line"></span><br><span class="line">    public ProductFlavor(String name, Project project, Instantiator instantiator, Logger logger, ErrorReporter errorReporter) &#123;</span><br><span class="line">        super(name, (DefaultVectorDrawablesOptions)instantiator.newInstance(VectorDrawablesOptions.class, new Object[0]));</span><br><span class="line">        this.project = project;</span><br><span class="line">        this.logger = logger;</span><br><span class="line">        this.errorReporter = errorReporter;</span><br><span class="line">        this.ndkConfig = (NdkOptions)instantiator.newInstance(NdkOptions.class, new Object[0]);</span><br><span class="line">        this.externalNativeBuildOptions = (ExternalNativeBuildOptions)instantiator.newInstance(ExternalNativeBuildOptions.class, new Object[]&#123;instantiator&#125;);</span><br><span class="line">        this.jackOptions = (JackOptions)instantiator.newInstance(JackOptions.class, new Object[0]);</span><br><span class="line">        this.javaCompileOptions = (JavaCompileOptions)instantiator.newInstance(JavaCompileOptions.class, new Object[]&#123;instantiator&#125;);</span><br><span class="line">        this.shaderOptions = (ShaderOptions)instantiator.newInstance(ShaderOptions.class, new Object[0]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>更加全面的文档可以参考: <a href="http://google.github.io/android-gradle-dsl/" target="_blank" rel="noopener">GoogleGradleDSL</a></p>
<h2><span id="apk-de-you-hua">APK的优化</span></h2><p>必要条件:</p>
<ul>
<li>SDK Tools 25.0.10 or higher</li>
<li>Android plugin for Gradle 2.0.0 or higher</li>
</ul>
<h3><span id="dai-ma-ceng-mian">代码层面</span></h3><p>基于Proguard,删掉无用的类方法等等<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="literal">true</span></span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3><span id="zi-yuan-ceng-mian">资源层面</span></h3><p>去掉无用的资源</p>
<p>只打包某些语言的资源, 可以减小包的体积.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">    ...</span><br><span class="line">    resConfigs <span class="string">"en"</span>, <span class="string">"zh"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有时候有一些特殊的资源不希望被删掉,可以这样配置:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span> <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:keep</span>=<span class="string">"@layout/l_used*_c,@layout/l_used_a,@layout/l_used_b*"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:discard</span>=<span class="string">"@layout/unused2"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>保存在这个文件中就可以了 res/raw/keep.xml. </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Note: The resource shrinker currently does not remove resources defined in a values/ folder (such as strings, dimensions, styles, and colors). This is because the Android Asset Packaging Tool (AAPT) does not allow the Gradle Plugin to specify predefined versions for resources. For details, see issue 70869.</span><br><span class="line"></span><br><span class="line">通过名字引用资源也想给删掉?</span><br><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span> <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:shrinkMode</span>=<span class="string">"strict"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Inici</a></li>
         
          <li><a href="/about/">Qui som</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/projects_url">Projectes</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">Android Gradle 作弊手册</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.1.</span> <span class="toc-text">如何打一个可执行的jar包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.2.</span> <span class="toc-text">如何引入外部依赖?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.3.</span> <span class="toc-text">如何配置签名?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.4.</span> <span class="toc-text">如何通过gradlew打包?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.5.</span> <span class="toc-text">Build Variant</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.5.1.</span> <span class="toc-text">一个例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.5.2.</span> <span class="toc-text">Android的gradle插件在哪里?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.5.3.</span> <span class="toc-text">我们来看看flavor在android gradle plugin中是怎么定义的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.6.</span> <span class="toc-text">APK的优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.6.1.</span> <span class="toc-text">代码层面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.6.2.</span> <span class="toc-text">资源层面</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2018/09/26/android-gradle/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2018/09/26/android-gradle/&text=Android Gradle 作弊手册"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2018/09/26/android-gradle/&title=Android Gradle 作弊手册"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2018/09/26/android-gradle/&is_video=false&description=Android Gradle 作弊手册"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Android Gradle 作弊手册&body=Check out this article: http://yoursite.com/2018/09/26/android-gradle/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2018/09/26/android-gradle/&title=Android Gradle 作弊手册"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2018/09/26/android-gradle/&title=Android Gradle 作弊手册"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2018/09/26/android-gradle/&title=Android Gradle 作弊手册"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2018/09/26/android-gradle/&title=Android Gradle 作弊手册"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2018/09/26/android-gradle/&name=Android Gradle 作弊手册&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menú</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Compartir</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Cap amunt</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 amas
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Inici</a></li>
         
          <li><a href="/about/">Qui som</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/projects_url">Projectes</a></li>
        
      </ul>
    </nav>
  </div>
</footer><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


